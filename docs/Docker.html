
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Docker &#8212; Documentation Abeille 12.12.2019</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/translations.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation Abeille 12.12.2019</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Docker</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="docker">
<h1>Docker<a class="headerlink" href="#docker" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="vm-osx">
<h2>VM OSX<a class="headerlink" href="#vm-osx" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une VM sous parallel OSX: debian 9.3.0 / Jeedom 3.1.7 / Abeille 2018-06-19 01:01:07</p>
<div class="section" id="vm">
<h3>VM<a class="headerlink" href="#vm" title="Lien permanent vers ce titre">¶</a></h3>
<p>Configuration: choisissez un réseau ponté pour avoir un IP à vous.</p>
</div>
<div class="section" id="debian">
<h3>Debian<a class="headerlink" href="#debian" title="Lien permanent vers ce titre">¶</a></h3>
<p>Installation de Debian des plus classique (Un gros 1/4 d’heure depuis un ISO sur disque).</p>
<p>Pas d’environnement de bureau, juste un serveur ssh et les utilitaires usuels système.</p>
<p>Une mise a jour en fin d’installation:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">su -</span>
<span class="x">vi /etc/apt/sources.list</span>
<span class="x">deb cdrom:[Debian GNU/Linux 9.3.0 _Stretch_ - Official amd64 DVD Binary-1 20171209-12:11]/ stretch contrib main</span>
<span class="x">apt-get update</span>
<span class="x">apt-get upgrade</span>
</pre></div>
</div>
</div>
<div class="section" id="jeedom">
<h3>Jeedom<a class="headerlink" href="#jeedom" title="Lien permanent vers ce titre">¶</a></h3>
<p>La documentation Jeedom est à la page <a class="reference external" href="https://Jeedom.github.io/documentation/installation/fr_FR/index">https://Jeedom.github.io/documentation/installation/fr_FR/index</a></p>
<p>Perso j’utilise le dernier chapitre (Chapitre 10 - Autres) (Un gros 1/4 d’heure)</p>
<p>Connectez-vous en SSH à votre système et faites :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">su -</span>
<span class="x">wget https://raw.githubusercontent.com/Jeedom/core/stable/install/install.sh</span>
<span class="x">chmod +x install.sh</span>
<span class="x">./install.sh</span>
<span class="x">./install.sh -w /var/www/html  -m Jeedom</span>
<span class="x">reboot</span>
</pre></div>
</div>
</div>
<div class="section" id="web-browser">
<h3>Web Browser<a class="headerlink" href="#web-browser" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ouvrir la page de votre Jeedom: <a class="reference external" href="http://Mon_IP_Jeedom">http://Mon_IP_Jeedom</a></p>
<p>admin/admin</p>
<p>Ne plus afficher et cloture fenetre du dessus.</p>
<p>Creation d’un Objet Abeille pour accueillir tous les futures équipement Zigbee:</p>
<p>Menu-&gt;Outils-&gt;Objets-&gt;”+”, Sauvegarder et retour sur la page principale(Dashboard)</p>
</div>
<div class="section" id="ajout-plugin-abeille">
<h3>Ajout Plugin Abeille<a class="headerlink" href="#ajout-plugin-abeille" title="Lien permanent vers ce titre">¶</a></h3>
<p>Menu-&gt;Plugins-&gt;Gestion des plugins</p>
<p>Market</p>
<p>Recherche Abeille</p>
<p>Selectionner Abeille</p>
<p>Installer stable (Version 2018-06-19 01:01:07)</p>
<p>Voulez vous aller sur la …. -&gt; Ok</p>
</div>
<div class="section" id="configuration-du-plugin">
<h3>Configuration du plugin<a class="headerlink" href="#configuration-du-plugin" title="Lien permanent vers ce titre">¶</a></h3>
<p>Activer</p>
<p>Dependances -&gt; Relancer (ou vous attendez et elles devraient s’installer automatiquement).</p>
<p>Deux messages doivent s’afficher pour confirmer le lancement et le lien vers la doc.</p>
<p>Une fois les dépendances installées, la date de derniere installation doit apparaitre.</p>
<p>Configuration:</p>
<ul class="simple">
<li><p>Choisissez le port serie (on suppose que vous avez une Zigate ttl sur un port USB déjà branchée, sinon branchez la et rafraichissez la page)</p></li>
<li><p>Choisissez l’Objet Parent: Abeille</p></li>
<li><p>Sauvegarder</p></li>
</ul>
<p>Le demon doit démarrer et passer au vert.</p>
<p>Dans mon cas mosquitto fait encore des siennes et il n’a pas démarré. Un reboot du systeme résoud le problème.</p>
<p>Rafraichir la page et vérifier que le demon est passé au vert: Statut Ok et Configuration: Ok.</p>
<p>Et maintenant tout est pret. Retour sur Dashboard. Vous devriez y touver l’équipement Ruche.</p>
</div>
<div class="section" id="demarrage-du-reseau-zigbee">
<h3>Demarrage du reseau zigbee<a class="headerlink" href="#demarrage-du-reseau-zigbee" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous selectionnez « Version » alors les champs “Last”, “Last Stamps”, “SW”, “SDK” doivent se mettre à jour. Cela confirme que cela fonctionne.</p>
<p>Vous pouvez démarrer le réseau « Start Network ».</p>
<p>Et faire un « get Network Status », d’autres champs vont se mettre à jour.</p>
<p>Voilà l’installation d’Abeille dans Jeedom est finie. Vous pouvez intégrer vo équipements.</p>
<p>En tout 1h pour faire une installation from scratch (et écrire cette doc).</p>
</div>
<div class="section" id="installation-dans-un-conteneur-depuis-ubuntu">
<h3>Installation dans un conteneur depuis Ubuntu<a class="headerlink" href="#installation-dans-un-conteneur-depuis-ubuntu" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h4>
<p>Debian supporte nativement Jeedom et le support est assuré par l’équipe de développement. Toute autre demande à propos d’une distribution est ignorée.   <a class="reference external" href="https://Jeedom.github.io/documentation/installation/fr_FR/index">https://Jeedom.github.io/documentation/installation/fr_FR/index</a></p>
<p>Docker permet d’installer un système invité minimal dans une partie virtualisée du système hôte, tout ajout/suppression/modification du conteneur laisse tel quel le système hôte. L’interet de docker est que n’est installé que le minimum nécéssaire au fonctionnement dans l’image. ( une image éxecutée est un conteneur.) Le but ici est de faire tourner un conteneur Jeedom sur un système Ubuntu, cependant ce n’est pas limité à ce système.</p>
</div>
<div class="section" id="prerequis">
<h4>Prérequis<a class="headerlink" href="#prerequis" title="Lien permanent vers ce titre">¶</a></h4>
<p>Avoir docker disponible dans les dépôts de la distribution.</p>
</div>
<div class="section" id="installation-de-docker">
<h4>Installation de docker<a class="headerlink" href="#installation-de-docker" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">apt-get install docker docker.io</span>
</pre></div>
</div>
</div>
<div class="section" id="fonctionnement">
<h4>Fonctionnement<a class="headerlink" href="#fonctionnement" title="Lien permanent vers ce titre">¶</a></h4>
<p>Un des créateurs de Jeedom maintient image Jeedom. Cette image appelé Jeedom-server utilise une image Jeedom-mysql pour stocker les données dans une base de données mysql. Il faudra donc a chaque fois lancer le conteneur Jeedom-mysql puis le Jeedom-server. Les réglages restent d’une fois sur l’autre.</p>
</div>
<div class="section" id="recuperation-des-images-et-creation-des-conteneurs">
<h4>Récupération des images et Création des conteneurs<a class="headerlink" href="#recuperation-des-images-et-creation-des-conteneurs" title="Lien permanent vers ce titre">¶</a></h4>
<p>Ces deux lignes vont récupérer les images, créer les conteneurs et les configurer. Le port USB est a adapter selon le besoin ( <cite>ls /dev/ttyUSB*</cite> pour avoir la liste )</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker run --name Jeedom-mysql -e MYSQL_ROOT_PASSWORD=MJeedom96 -d mysql:latest</span>
<span class="x">docker run --name Jeedom-server -e ROOT_PASSWORD=MJeedom96 --link Jeedom-mysql:mysql -p 9180:80 -p 9443:443 -p 9022:22 --device=/dev/ttyUSB0 Jeedom/Jeedom</span>
</pre></div>
</div>
<p>A ce stade, l’installation de Jeedom commence dans le conteneur Jeedom-server. il faut compter 5 a 10 minutes selon la connexion et la puissance du système hôte.</p>
<p>Jeedom sera disponible après quelques instants à l’adresse <a class="reference external" href="http://0.0.0.0:9180">http://0.0.0.0:9180</a></p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Le ssh est accessible via le port 9022. (root/MJeedom96)</p>
</div>
</div>
<div class="section" id="configuration-de-jeedom">
<h4>Configuration de Jeedom<a class="headerlink" href="#configuration-de-jeedom" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans les champs indiqués entrer la valeur surlignée.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">[width=&quot;40%&quot;,frame=&quot;topbot&quot;,options=&quot;header,footer&quot;]</span>
<span class="x">|==================================</span>
<span class="x">|Database hostname| Jeedom-mysql</span>
<span class="x">|Database port    | 3306</span>
<span class="x">|Database username| root</span>
<span class="x">|Database password| MJeedom96</span>
<span class="x">|Database name    | Jeedom</span>
<span class="x">|Erase database   | checked</span>
<span class="x">|==================================</span>
</pre></div>
</div>
<p>Une fois, le texte <cite>[END INSTALL SUCCESS]</cite> affiché en bas. Aller à l “adresse <a class="reference external" href="http://0.0.0.0:9180">http://0.0.0.0:9180</a> la page de login de Jeedom devrait apparaître. Les login et mot de passe sont admin admin.</p>
</div>
<div class="section" id="start-stop-des-conteneurs">
<h4>Start/stop des conteneurs<a class="headerlink" href="#start-stop-des-conteneurs" title="Lien permanent vers ce titre">¶</a></h4>
<p>les conteneurs peuvent être arrêtés et relancés à la demande en gardant l’ordre mysql Jeedom au lancement, Jeedom mysql à  l’arrêt.</p>
<p>Arrêt <cite>docker stop Jeedom-server &amp;&amp; docker stop Jeedom-mysql</cite></p>
<p>Démarrage <cite>docker start Jeedom-mysql &amp;&amp; docker start Jeedom-server</cite></p>
</div>
<div class="section" id="repartir-de-zero">
<h4>Repartir de zéro<a class="headerlink" href="#repartir-de-zero" title="Lien permanent vers ce titre">¶</a></h4>
<p>il est possible de supprimer les conteneurs et de repartir d’un Jeedom tout neuf.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker rm Jeedom-server &amp;&amp; docker rm Jeedom-mysql</span>
</pre></div>
</div>
<p>puis aller vers link:[Récupération des images et Création des conteneurs]</p>
</div>
<div class="section" id="portainer">
<h4>Portainer<a class="headerlink" href="#portainer" title="Lien permanent vers ce titre">¶</a></h4>
<p>Pour ceux que ne sont pas à l’aise avec la ligne de commande, portainer propose une interface graphique pour gérer les conteneurs et les images.
C’est un conteneur à démarrage automatique qui pourra relancer les conteneurs crées.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</span>
</pre></div>
</div>
<p>le site sera disponible à l’adresse <a class="reference external" href="http://0.0.0.0:9000">http://0.0.0.0:9000</a></p>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Docker<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h2>
<p>Installation d’Abeille dans docker
(Il y a certainement plus simple mais je ne suis pas expert en Docker et cette méthode semble bien fonctionner).</p>
<div class="section" id="preparation-du-docker">
<h3>Preparation du docker<a class="headerlink" href="#preparation-du-docker" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="preparation-sous-raspbian">
<h4>Preparation sous Raspbian<a class="headerlink" href="#preparation-sous-raspbian" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li><p>installer 2018-06-27-raspbian-stretch-lite.zip sur une SD</p></li>
<li><p>demarrer le RPI3</p></li>
<li><p>se logger pi/raspberry (atttention au clavier US par defaut)</p></li>
<li><p>lancer raspi-config (faire la conf que vous souhaitez): sshd, all memory space, clavier, locales,…</p></li>
<li><p>Vérifier la conf réseau</p></li>
<li><p>Vous connecter en ssh pour la suite:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">ssh pi@IP</span>
</pre></div>
</div>
<ul class="simple">
<li><p>La suite se fait entant que root: sudo su -</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">sudo su -</span>
</pre></div>
</div>
<ul class="simple">
<li><p>une classique mise a jour du systeme:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">apt-get update, apt-get upgrade</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Restart du RPI</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">reboot</span>
<span class="x">ssh pi@IP</span>
<span class="x">sudo su -</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Installation de docker:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">apt-get install docker</span>
<span class="x">apt-get install docker.io</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vérifier que cela fonctionne, un docker ps -a pour voir les images:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker ps -a</span>
</pre></div>
</div>
<p>On voit ici qu’il n’y a pas d’image, il faut en créer une. Flasher la SD. Demarrer le PI et une commande:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker ps</span>
</pre></div>
</div>
<p>Permet de voir que docker fonctionne.</p>
</div>
</div>
<div class="section" id="preparation-sous-hypriot">
<h3>Preparation sous hypriot<a class="headerlink" href="#preparation-sous-hypriot" title="Lien permanent vers ce titre">¶</a></h3>
<p>La version officielle raspbian est un peu vieille et nous n’avons pas toutes les nouveautés. Hypriot a une version bien plus recente et nous facilite la vie (pas de config manuelle tout est prêt). Elle permet aussi de faire tourner le plugin Homebridge (macvlan).
<a class="reference external" href="http://blog.hypriot.com">http://blog.hypriot.com</a></p>
<p>Telecharger leur image à l adresse: <a class="reference external" href="http://blog.hypriot.com/downloads/">http://blog.hypriot.com/downloads/</a></p>
<p>On voit ici qu’il n’y a pas d’image, il faut en créer une.</p>
<div class="section" id="creons-un-system-pour-le-docker">
<h4>Créons un system pour le docker.<a class="headerlink" href="#creons-un-system-pour-le-docker" title="Lien permanent vers ce titre">¶</a></h4>
<p><a class="reference external" href="http://www.guoyiang.com/2016/11/04/Build-My-Own-Raspbian-Docker-Image/">http://www.guoyiang.com/2016/11/04/Build-My-Own-Raspbian-Docker-Image/</a></p>
<p>Ici je ne cherche pas à faire une image la plus petite possible mais la plus proche possible d’une install classique sur un HW RPI3. De ce fait l’image fait presque 1G.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">mkdir DockerAbeille</span>
<span class="x">cd DockerAbeille</span>
</pre></div>
</div>
<p>Recuperer le fichier 2018-06-27-raspbian-stretch-lite.zip par scp par exemple. Puis:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">unzip 2018-06-27-raspbian-stretch-lite.zip</span>
<span class="x">losetup -Pr /dev/loop0 2018-06-27-raspbian-stretch-lite.img</span>
<span class="x">mkdir rpi</span>
<span class="x">mount -o ro /dev/loop0p2 ./rpi</span>
<span class="x">tar -C ./rpi -czpf 2018-06-27-raspbian-stretch-lite.tar.gz --numeric-owner .</span>
<span class="x">umount ./rpi</span>
<span class="x">losetup -d /dev/loop0</span>
<span class="x">rmdir rpi</span>
<span class="x">rm 2018-06-27-raspbian-stretch-lite.img</span>
<span class="x">rm 2018-06-27-raspbian-stretch-lite.zip</span>
<span class="x">echo &#39;FROM scratch&#39; &gt; Dockerfile</span>
<span class="x">echo &#39;ADD ./2018-06-27-raspbian-stretch-lite.tar.gz /&#39; &gt;&gt; Dockerfile</span>
<span class="x">echo &#39;CMD [&quot;/bin/bash&quot;]&#39; &gt;&gt; Dockerfile</span>
</pre></div>
</div>
<p>Maintenant on lance la creation du docker:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker build -t JeedomAbeille .</span>
</pre></div>
</div>
<p>[TIP]: Bien mettre le . a la fin de la ligne.</p>
<p>Le résultat doit ressembler à:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@docker:~/DockerAbeille= docker build -t JeedomAbeille .</span>
<span class="x">Sending build context to Docker daemon 348.4 MB</span>
<span class="x">Step 0 : FROM scratch</span>
<span class="x">---&gt;</span>
<span class="x">Step 1 : ADD ./2018-06-27-raspbian-stretch-lite.tar.gz /</span>
<span class="x">---&gt; f7009768b966</span>
<span class="x">Removing intermediate container ef5668638536</span>
<span class="x">Step 2 : CMD /bin/bash</span>
<span class="x">---&gt; Running in d95d0e65bbb4</span>
<span class="x">---&gt; 286ea5048dfd</span>
<span class="x">Removing intermediate container d95d0e65bbb4</span>
<span class="x">Successfully built 286ea5048dfd</span>
</pre></div>
</div>
<p>Et si vous demandez les images:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@docker:~/DockerAbeille= docker images</span>
<span class="x">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span>
<span class="x">JeedomAbeille       latest              286ea5048dfd        12 minutes ago      900.9 MB</span>
</pre></div>
</div>
<p>Démarrons le container:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker run -it JeedomAbeille</span>
</pre></div>
</div>
<p>Le shell vous donne la main dans le docker:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@52b658b7d8f8:/=</span>
</pre></div>
</div>
<p>Vous pouvez arreter le docker depuis un shell sur le host:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@docker:~/DockerAbeille= docker ps</span>
<span class="x">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span>
<span class="x">52b658b7d8f8        JeedomAbeille       &quot;/bin/bash&quot;         3 minutes ago       Up 3 minutes                            sad_stallman</span>
<span class="x">root@docker:~/DockerAbeille= docker stop 52b658b7d8f8</span>
<span class="x">52b658b7d8f8</span>
</pre></div>
</div>
<p>Vous pouvez demarrer de docker depuis un shell sur le host:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@docker:~/DockerAbeille= docker ps -a</span>
<span class="x">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES</span>
<span class="x">52b658b7d8f8        JeedomAbeille       &quot;/bin/bash&quot;         7 minutes ago       Exited (127) 3 minutes ago                       sad_stallman</span>
<span class="x">root@docker:~/DockerAbeille= docker start 52b658b7d8f8</span>
<span class="x">52b658b7d8f8</span>
</pre></div>
</div>
<p>Vous pouvez vous connecter au docker:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@docker:~/DockerAbeille= docker attach 52b658b7d8f8</span>
<span class="x">root@52b658b7d8f8:/=</span>
</pre></div>
</div>
<p>[TIP]: Faites plusieurs « enter » pour avoir le prompt.</p>
<p>Maintenant que le docker fonctionne on va faire l installation de Jeedom et Abeille.</p>
<p>[TIP]: To stop a container, use CTRL-c. This key sequence sends SIGKILL to the container. If –sig-proxy is true (the default),CTRL-c sends a SIGINT to the container. You can detach from a container and leave it running using the [underline]#CTRL-p suivi de CTRL-q# key sequence.</p>
</div>
</div>
<div class="section" id="service-dans-le-docker">
<h3>Service dans le docker<a class="headerlink" href="#service-dans-le-docker" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les services ne demarrent pas tout seuls dans le docker, il aurait probablement du le faire dans Dockfile.</p>
<p>Donc j’ajoute quelques lignes à /etc/rc.local pour Raspbian:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker start JeedomAbeille</span>
<span class="x">docker exec -u root JeedomAbeille /etc/init.d/ssh start</span>
<span class="x">docker exec -u root JeedomAbeille /etc/init.d/mysql start</span>
<span class="x">docker exec -u root JeedomAbeille /etc/init.d/apache2 start</span>
<span class="x">docker exec -u root JeedomAbeille /etc/init.d/cron start</span>
</pre></div>
</div>
<p>que je mets sur le host dans /root sous le nom startJeedomAbeileDocker.sh.
et un bon vieux:  chmod u+x startJeedomAbeileDocker.sh</p>
<p>et pour hypriot qui n’a pas de rc.local, je fait un script:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">sudo su -</span>
<span class="x">cd /etc/init.d</span>
<span class="x">vi startDockers</span>
</pre></div>
</div>
<p>Je mets dedans</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">=! /bin/sh</span>
<span class="x">= /etc/init.d/startDockers</span>

<span class="x">=== BEGIN INIT INFO</span>
<span class="x">== Provides:          startDockers</span>
<span class="x">== Required-Start:    $remote_fs $syslog</span>
<span class="x">== Required-Stop:     $remote_fs $syslog</span>
<span class="x">== Default-Start:     2 3 4 5</span>
<span class="x">== Default-Stop:      0 1 6</span>
<span class="x">== Short-Description: Simple script to start a program at boot</span>
<span class="x">== Description:       A simple script from www.stuffaboutcode.com which will start / stop a program a boot / shutdown.</span>
<span class="x">=== END INIT INFO</span>

<span class="x">== If you want a command to always run, put it here</span>

<span class="x">== Carry out specific functions when asked to by the system</span>
<span class="x">case &quot;$1&quot; in</span>
<span class="x">start)</span>
<span class="x">echo &quot;Starting startDockers&quot;</span>
<span class="x">== run application you want to start</span>
<span class="x">docker start Jeedomgite</span>
<span class="x">docker exec -u root Jeedomgite /etc/init.d/ssh start</span>
<span class="x">docker exec -u root Jeedomgite /etc/init.d/mysql start</span>
<span class="x">docker exec -u root Jeedomgite /etc/init.d/apache2 start</span>
<span class="x">docker exec -u root Jeedomgite /etc/init.d/cron start</span>
<span class="x">;;</span>
<span class="x">stop)</span>
<span class="x">echo &quot;Stopping startDockers&quot;</span>
<span class="x">= kill application you want to stop</span>
<span class="x">docker stop Jeedomgite</span>
<span class="x">;;</span>
<span class="x">*)</span>
<span class="x">echo &quot;Usage: /etc/init.d/startDockers {start|stop}&quot;</span>
<span class="x">exit 1</span>
<span class="x">;;</span>
<span class="x">esac</span>

<span class="x">exit 0</span>
</pre></div>
</div>
<p>Je sauvegarde.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">chmod 755 /etc/init.d/startDockers</span>
<span class="x">/etc/init.d/startDockers start</span>
<span class="x">update-rc.d startDockers defaults</span>
</pre></div>
</div>
<p>Ajouter la ligne</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">* * * * * su --shell=/bin/bash - www-data -c &#39;/usr/bin/php /var/www/html/core/php/jeeCron.php&#39; &gt;&gt; /dev/null</span>
</pre></div>
</div>
<p>dans le cron root.</p>
<p>Thanks to <a class="reference external" href="https://www.stuffaboutcode.com/2012/06/raspberry-pi-run-program-at-start-up.html">https://www.stuffaboutcode.com/2012/06/raspberry-pi-run-program-at-start-up.html</a></p>
<div class="section" id="installation-jeedom">
<h4>Installation Jeedom<a class="headerlink" href="#installation-jeedom" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans le container precedent nous n’avons pas pris en compte les besoins réseaux et port série.
Effaçons l’ancien container.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker rm 52b658b7d8f8</span>
</pre></div>
</div>
<p>Créons en un nouveau avec les ports mysql, apache, ssh et le port serie ttyUSB0 (la Zigate).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker run --name=JeedomAbeille --device=/dev/ttyUSB0 -p 2222:22 -p 80:80 -p 3306:3306 -it JeedomAbeille</span>
<span class="x">docker run --name=Jeedomgite --device=/dev/ttyACM0 -p 51826:51826 -p 5353:5353 -p 2222:22 -p 80:80 -p 3306:3306 -it Jeedomgite</span>
</pre></div>
</div>
<p>Si vous êtes sur hyprio et voulez exposer la machine completement, créé le Networks puis le Containers:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker network create -d macvlan --subnet=192.168.4.0/24 --gateway=192.168.4.2 -o parent=eth0 pub_net</span>
<span class="x">docker run --name=Jeedomgite --device=/dev/ttyACM0 --network pub_net --ip=192.168.4.38 --hostname=Jeedomgite -it Jeedomgite /bin/bash</span>
</pre></div>
</div>
<p>Attention de ne pas vous prendre les pieds dans le tapis entre les adresses du « HW » rpi et les addresses des containers.</p>
<p>Donc Jeedom sera accessible sur le port 80 à l’adresse IP du host. 2222 pour ssh et 3306 pour mysql.
J’ai mis un nom pour être plus sympas à gérer.</p>
<p>Vous pourrez le demarrer/arreter par:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker stop JeedomAbeille</span>
<span class="x">docker start JeedomAbeille</span>
</pre></div>
</div>
<p>Passons a l installation des services:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker attach JeedomAbeille</span>
<span class="x">apt-get update</span>
<span class="x">apt-get upgrade</span>
<span class="x">apt-get install openssh-server</span>
<span class="x">dpkg-reconfigure openssh-server</span>
<span class="x">/etc/init.d/ssh start</span>
<span class="x">apt-get install mariadb-server</span>
<span class="x">apt-get install apache2</span>
</pre></div>
</div>
<p>Maintenant le systeme doit être prêt pour l installation de Jeedom lui-meme.
(<a class="reference external" href="https://Jeedom.github.io/documentation/installation/fr_FR/index">https://Jeedom.github.io/documentation/installation/fr_FR/index</a> =&gt; Chap 10)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">wget https://raw.githubusercontent.com/Jeedom/core/stable/install/install.sh</span>
<span class="x">chmod +x install.sh</span>
<span class="x">./install.sh -w /var/www/html -m Jeedom</span>
</pre></div>
</div>
<p>L installation va se dérouler en 11 grandes étapes.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">étape 11 vérification de Jeedom réussie</span>
<span class="x">/!\ IMPORTANT /!\ Le mot de passe root MySQL est Jeedom</span>
<span class="x">Installation finie. Un redémarrage devrait être effectué</span>
</pre></div>
</div>
<p>avec un ps -ef, vous devriez voir apache, ssh et mysql fonctionner.</p>
<p>Puis vous vous connecter à Jeedom avec l adresse <a class="reference external" href="http://IP_Host:80/">http://IP_Host:80/</a>
Connectez vous avec admin/admin.
Sauf que cela ne fonctionne pas !! -&gt;Mot de passe ou nom d’utilisateur incorrect&lt;-</p>
<p>Il demande un reboot donc allons y:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker stop JeedomAbeille</span>
<span class="x">docker start JeedomAbeille</span>
<span class="x">docker attach JeedomAbeille</span>
<span class="x">/etc/init.d/ssh start</span>
<span class="x">/etc/init.d/mysql start</span>
<span class="x">/etc/init.d/apache2 start</span>
</pre></div>
</div>
<p>On ne peut toujours pas se connecter, je ne sais pas pourquoi….</p>
<p>Donc on va passer par une autre solution: <a class="reference external" href="https://Jeedom.github.io/documentation/howto/fr_FR/reset.password">https://Jeedom.github.io/documentation/howto/fr_FR/reset.password</a></p>
<p>Problement de « Could not reliably determine the server’s fully qualified domain name, using 172.17.0.14. Set the “ServerName” directive globally to suppress this message »:
mettre en debut de fichier /etc/apache2/apache2.conf la line :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">Global configuration</span>
<span class="x">ServerName 2b8faafb19a4</span>
<span class="x">root@2b8faafb19a4:/etc/apache2= apachectl configtest</span>
<span class="x">Syntax OK</span>
</pre></div>
</div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">= Global configuration</span>
<span class="x">=</span>
<span class="x">ServerName 2b8faafb19a4</span>
</pre></div>
</div>
<p>Puis tester:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@2b8faafb19a4:/etc/apache2= apachectl configtest</span>
<span class="x">Syntax OK</span>
</pre></div>
</div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">root@2b8faafb19a4:/etc/apache2= cat /etc/hosts</span>
<span class="x">127.0.0.1    localhost</span>
<span class="x">::1    localhost ip6-localhost ip6-loopback</span>
<span class="x">fe00::0    ip6-localnet</span>
<span class="x">ff00::0    ip6-mcastprefix</span>
<span class="x">ff02::1    ip6-allnodes</span>
<span class="x">ff02::2    ip6-allrouters</span>
<span class="x">172.17.0.14    2b8faafb19a4    JeedomAbeille</span>
<span class="x">172.17.0.14    JeedomAbeille.bridge</span>

<span class="x">.. code-block:: php</span>

<span class="x">cat /var/www/html/core/config/common.config.php</span>
<span class="x">mysql -uJeedom -p</span>
<span class="x">use Jeedom;</span>
<span class="x">REPLACE INTO user SET `login`=&#39;adminTmp&#39;,password=&#39;c7ad44cbad762a5da0a452f9e854fdc1e0e7a52a38015f23f3eab1d80b931dd472634dfac71cd34ebc35d16ab7fb8a90c81f975113d6c7538dc69dd8de9077ec&#39;,profils=&#39;admin&#39;, enable=&#39;1&#39;;</span>
<span class="x">exit</span>
</pre></div>
</div>
<p>Et maintenant on peut se connecter en adminTmp/admin.</p>
<p>Aller dans la conf reseau et mettre l adresse du host dans les adresses http.</p>
<p>Maintenant on peut se connecter en admin/admin donc on peut effacer l utilisateur adminTmp.</p>
</div>
<div class="section" id="installation-du-plugin-abeille">
<h4>Installation du plugin Abeille<a class="headerlink" href="#installation-du-plugin-abeille" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li><p>Créer un objet Abeille.</p></li>
<li><p>Installer le plugin Abeille depuis le market.</p></li>
<li><p>L’activer.</p></li>
<li><p>Lancer l installation des dépendances.</p></li>
<li><p>Definissez les bons parametres du demon.</p></li>
<li><p>Lancer le demon</p></li>
<li><p>L objet Ruche doit être créé.</p></li>
<li><p>un petit getVersion et vous devriez avoir le champ SW et SDK qui se mettent à jour.</p></li>
</ul>
<p>Enjoy !!!</p>
<div class="admonition hint">
<p class="admonition-title">Indication</p>
<p>Vous allez certainement avoir le message:
« Jeedom est en cours de démarrage, veuillez patienter. La page se rechargera automatiquement une fois le démarrage terminé. »</p>
<p>Aller dans le « Moteur de taches » et lancer « Jeedom-cron ».</p>
</div>
</div>
</div>
<div class="section" id="backup-du-docker">
<h3>Backup du Docker<a class="headerlink" href="#backup-du-docker" title="Lien permanent vers ce titre">¶</a></h3>
<p>Plusieures solutions s’offrent à nous. Il est interessant de comprende ce qui se passe. Un bon article à lire: <a class="reference external" href="https://tuhrig.de/difference-between-save-and-export-in-docker/">https://tuhrig.de/difference-between-save-and-export-in-docker/</a></p>
<p>Toutes les operations suivantes se font depuis le host.</p>
<div class="section" id="commit-save-load">
<h4>Commit / Save / Load<a class="headerlink" href="#commit-save-load" title="Lien permanent vers ce titre">¶</a></h4>
<p>Permet de garder tout l’historique.</p>
</div>
<div class="section" id="commit">
<h4>Commit<a class="headerlink" href="#commit" title="Lien permanent vers ce titre">¶</a></h4>
<p>Pour avoir les docker en fonctionnement :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker ps</span>
</pre></div>
</div>
<p>Pour avoir les docker en stock:
.. code-block:: php</p>
<blockquote>
<div><p>docker ps -a</p>
</div></blockquote>
<p>Créons un image du docker en prod: JeedomAbeille et appelons cette image JeedomAbeille_backup</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker commit -p JeedomAbeille JeedomAbeille_backup</span>
</pre></div>
</div>
<p>Attention: avec le -p le container est en pause donc Jeedom ne fonctionne plus le temps de faire la capture.</p>
<p>Par exemple: faites cette operation avant de faire des opérations irréversibles qui risquent de planter votre Jeedom.</p>
<p>Pour voir les images crées et disponiqbles:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker images</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="save">
<h3>Save<a class="headerlink" href="#save" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker save -o ~/JeedomAbeille_backup.tar JeedomAbeille_backup</span>
<span class="x">ls -l ~/JeedomAbeille_backup.tar</span>
</pre></div>
</div>
<p>soyez patient le tar fait 3G.</p>
</div>
<div class="section" id="load">
<h3>Load<a class="headerlink" href="#load" title="Lien permanent vers ce titre">¶</a></h3>
<p>If we have transferred our « container1.tar » backup file to another docker host system we first need to load backed up tar file into a docker’s local image repository:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker load -i /root/JeedomAbeille_backup.tar</span>
<span class="x">docker images</span>
</pre></div>
</div>
</div>
<div class="section" id="export-import">
<h3>Export / Import<a class="headerlink" href="#export-import" title="Lien permanent vers ce titre">¶</a></h3>
<p>Garde que la derniere version.</p>
</div>
<div class="section" id="export">
<h3>Export<a class="headerlink" href="#export" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker ps -a</span>
<span class="x">docker export &lt;CONTAINER ID&gt; &gt; /home/export.tar</span>
</pre></div>
</div>
</div>
<div class="section" id="import">
<h3>Import<a class="headerlink" href="#import" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">cat /home/export.tar | sudo docker import - NameYouWant:latest</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Lien permanent vers ce titre">¶</a></h3>
<p>Plus besoin d’aller chercher les cartes SD dans les differents RPI3 pour en faire de images. Tout va se faire à distance maintenant !!! YaaahhhOOOOUUU !!!!!</p>
<p>Vous pouvez effacer de vieilles images par:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker rmi JeedomAbeille_backup</span>
</pre></div>
</div>
</div>
<div class="section" id="docker-gui">
<h3>Docker GUI<a class="headerlink" href="#docker-gui" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="sur-la-raspbian">
<h4>Sur la raspbian<a class="headerlink" href="#sur-la-raspbian" title="Lien permanent vers ce titre">¶</a></h4>
<p>Thanks to:
* <a class="reference external" href="http://blog.hypriot.com/post/new-docker-ui-portainer/">http://blog.hypriot.com/post/new-docker-ui-portainer/</a>
* <a class="reference external" href="https://portainer.readthedocs.io/en/latest/deployment.html">https://portainer.readthedocs.io/en/latest/deployment.html</a></p>
<p>Il semble qu’on puisse utiliser une interface graphique « portainer.io » sur le rpi, saisir:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer:arm -H unix:///var/run/docker.sock</span>
</pre></div>
</div>
<p>Puis se logger sur <a class="reference external" href="http://IP_Host:9000">http://IP_Host:9000</a>
Tout ne fonctionne pas mais c’est plus sympas que la ligne de commande.</p>
<p>Il semble que la version rpi par defaut est un peu ancienne et certaine feature comme volume ne sont pas dispo.</p>
</div>
<div class="section" id="sur-la-hypriot">
<h4>Sur la hypriot<a class="headerlink" href="#sur-la-hypriot" title="Lien permanent vers ce titre">¶</a></h4>
<p><a class="reference external" href="https://hub.docker.com/r/hypriot/rpi-portainer/">https://hub.docker.com/r/hypriot/rpi-portainer/</a></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">docker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock hypriot/rpi-portainer</span>
</pre></div>
</div>
<p>Puis se logger sur <a class="reference external" href="http://IP_Host:9000">http://IP_Host:9000</a>.
Tout fonctionne bien mieux que sur la version raspbian.</p>
</div>
</div>
<div class="section" id="plugins">
<h3>Plugins<a class="headerlink" href="#plugins" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="zwave">
<h4>Zwave<a class="headerlink" href="#zwave" title="Lien permanent vers ce titre">¶</a></h4>
<p>Sur ma machine Jeedomprorpi, le repertoire /tmp/Jeedom/openzwave n’a pas les bons droits et le demon est toujours en erreur. Je viens de faire un chmod 777 /tmp/Jeedom/openzwave et tout est ok maintenant.</p>
</div>
<div class="section" id="homebridge">
<h4>homebridge<a class="headerlink" href="#homebridge" title="Lien permanent vers ce titre">¶</a></h4>
<p>Comme il faut que le docker soit exposé au sous réseau, il faut utiliser macvlan et affecter une adresse spécifique.</p>
</div>
</div>
<div class="section" id="installation-sur-une-vm-ubuntu">
<h3>Installation sur une VM Ubuntu<a class="headerlink" href="#installation-sur-une-vm-ubuntu" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="installation-de-l-os">
<h4>Installation de l’OS<a class="headerlink" href="#installation-de-l-os" title="Lien permanent vers ce titre">¶</a></h4>
<p>Fichier ISO: ubuntu-16.04.1-server-amd64.iso</p>
<p>Installation classique de l’OS (Je ne détaille pas car cela dépend de votre envirroement de virtualisation).</p>
</div>
<div class="section" id="preparation-de-l-os">
<h4>Preparation de l’OS<a class="headerlink" href="#preparation-de-l-os" title="Lien permanent vers ce titre">¶</a></h4>
<p>login: (user créé pendant l install avec son password associé).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">sudo su -</span>
<span class="x">apt-get update</span>
<span class="x">apt-get upgrade</span>
<span class="x">apt-get autoremove</span>
</pre></div>
</div>
</div>
<div class="section" id="installation-de-la-base-mysql">
<h4>Installation de la base mysql<a class="headerlink" href="#installation-de-la-base-mysql" title="Lien permanent vers ce titre">¶</a></h4>
<p>installation à la main de mysql (car l instanllation par Jeedom ne fonctionne pas)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">apt-get install mysql-server</span>
<span class="x">apt-get install mysql-client</span>
</pre></div>
</div>
</div>
<div class="section" id="installation-de-jeedom">
<h4>Installation de Jeedom<a class="headerlink" href="#installation-de-jeedom" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">wget https://raw.githubusercontent.com/Jeedom/core/stable/install/install.sh</span>
<span class="x">chmod +x install.sh</span>
</pre></div>
</div>
<p>Enlever le php7.0-ssh2 du fichier install.sh</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">./install.sh -m motDePasse</span>
</pre></div>
</div>
<p>A cette étape vous devoir pourvoir ouvrir un browser et utiliser Jeedom.</p>
</div>
<div class="section" id="id2">
<h4>Installation du Plugin Abeille<a class="headerlink" href="#id2" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">./install.sh -m motDePasse</span>

<span class="x">cd /var/www/html/plugins/</span>

<span class="x">git clone https://github.com/KiwiHC16/Abeille.git Abeille</span>

<span class="x">chmod -R 777 /var/www/html/plugins/Abeille</span>
<span class="x">chown -R www-data:www-data /var/www/html/plugins/Abeille</span>
</pre></div>
</div>
</div>
<div class="section" id="utilisation-de-jeedom">
<h4>Utilisation de Jeedom<a class="headerlink" href="#utilisation-de-jeedom" title="Lien permanent vers ce titre">¶</a></h4>
<p>Il ne vous reste plus qu’à vous connecter à Jeedom…</p>
</div>
<div class="section" id="installation-sur-une-machine-odroid-xu4-avec-ubuntu">
<h4>Installation sur une machine Odroid XU4 avec Ubuntu<a class="headerlink" href="#installation-sur-une-machine-odroid-xu4-avec-ubuntu" title="Lien permanent vers ce titre">¶</a></h4>
</div>
<div class="section" id="id3">
<h4>Installation de l’OS<a class="headerlink" href="#id3" title="Lien permanent vers ce titre">¶</a></h4>
<p>Fichier img: ubuntu-14.04lts-server-odroid-xu3-20150725.img
que l on trouve sur le server odroid: <a class="reference external" href="https://odroid.in/ubuntu_14.04lts/">https://odroid.in/ubuntu_14.04lts/</a></p>
<p>Installation classique odroid de l’OS : <a class="reference external" href="https://wiki.odroid.com/odroid-xu4/odroid-xu4">https://wiki.odroid.com/odroid-xu4/odroid-xu4</a></p>
</div>
<div class="section" id="id4">
<h4>Preparation de l’OS<a class="headerlink" href="#id4" title="Lien permanent vers ce titre">¶</a></h4>
<p>login: (root/odroid).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">apt-get update</span>
<span class="x">apt-get upgrade</span>
<span class="x">apt-get autoremove</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Installation de la base mysql<a class="headerlink" href="#id5" title="Lien permanent vers ce titre">¶</a></h4>
<p>installation à la main de mysql (car l instanllation par Jeedom ne fonctionne pas)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">apt-get install mysql-server</span>
<span class="x">apt-get install mysql-client</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Installation de Jeedom<a class="headerlink" href="#id6" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">wget https://raw.githubusercontent.com/Jeedom/core/stable/install/install.sh</span>
<span class="x">chmod +x install.sh</span>
</pre></div>
</div>
<p>Enlever le php7.0-ssh2 du fichier install.sh</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">./install.sh -m motDePasse</span>
</pre></div>
</div>
<p>A cette étape vous devoir pourvoir ouvrir un browser et utiliser Jeedom.</p>
</div>
<div class="section" id="id7">
<h4>Installation du Plugin Abeille<a class="headerlink" href="#id7" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">./install.sh -m motDePasse</span>

<span class="x">cd /var/www/html/plugins/</span>

<span class="x">git clone https://github.com/KiwiHC16/Abeille.git Abeille</span>

<span class="x">chmod -R 777 /var/www/html/plugins/Abeille</span>
<span class="x">chown -R www-data:www-data /var/www/html/plugins/Abeille</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h4>Utilisation de Jeedom<a class="headerlink" href="#id8" title="Lien permanent vers ce titre">¶</a></h4>
<p>Il ne vous reste plus qu’à vous connecter à Jeedom…</p>
</div>
</div>
<div class="section" id="de-installation">
<h3>De-installation<a class="headerlink" href="#de-installation" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le plugin Abeille utilise:
- le code du plugin lui-même et
- un broker MQTT mosquitto.</p>
<p>Par défaut, lors de l’installation de Abeille, le code du plugin est installé depuis le market et le broker est installé lors de l installation des dépendances.</p>
<p>Le broker MQTT peux être utilisé par d’autres logiciels comme par d’autres plugins.</p>
<p>C’est pourquoi lors de la desinstallation d’Abeille, mosquitto n’est pas desintallé, ni sa configuration.</p>
<p>Si vous souhaitez le desinstaller, vous avez le script « manual_remove_of_mosquito.sh » qui peut vous aider à enlever les déclaraitons faites dans apaches.</p>
<p>Pour la désinstallation de mosquitto, cela depend de votre système et il y a plein de doc sur le net (je manque de temps pour faire la doc…).</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table des matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Docker</a><ul>
<li><a class="reference internal" href="#vm-osx">VM OSX</a><ul>
<li><a class="reference internal" href="#vm">VM</a></li>
<li><a class="reference internal" href="#debian">Debian</a></li>
<li><a class="reference internal" href="#jeedom">Jeedom</a></li>
<li><a class="reference internal" href="#web-browser">Web Browser</a></li>
<li><a class="reference internal" href="#ajout-plugin-abeille">Ajout Plugin Abeille</a></li>
<li><a class="reference internal" href="#configuration-du-plugin">Configuration du plugin</a></li>
<li><a class="reference internal" href="#demarrage-du-reseau-zigbee">Demarrage du reseau zigbee</a></li>
<li><a class="reference internal" href="#installation-dans-un-conteneur-depuis-ubuntu">Installation dans un conteneur depuis Ubuntu</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#prerequis">Prérequis</a></li>
<li><a class="reference internal" href="#installation-de-docker">Installation de docker</a></li>
<li><a class="reference internal" href="#fonctionnement">Fonctionnement</a></li>
<li><a class="reference internal" href="#recuperation-des-images-et-creation-des-conteneurs">Récupération des images et Création des conteneurs</a></li>
<li><a class="reference internal" href="#configuration-de-jeedom">Configuration de Jeedom</a></li>
<li><a class="reference internal" href="#start-stop-des-conteneurs">Start/stop des conteneurs</a></li>
<li><a class="reference internal" href="#repartir-de-zero">Repartir de zéro</a></li>
<li><a class="reference internal" href="#portainer">Portainer</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id1">Docker</a><ul>
<li><a class="reference internal" href="#preparation-du-docker">Preparation du docker</a><ul>
<li><a class="reference internal" href="#preparation-sous-raspbian">Preparation sous Raspbian</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preparation-sous-hypriot">Preparation sous hypriot</a><ul>
<li><a class="reference internal" href="#creons-un-system-pour-le-docker">Créons un system pour le docker.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-dans-le-docker">Service dans le docker</a><ul>
<li><a class="reference internal" href="#installation-jeedom">Installation Jeedom</a></li>
<li><a class="reference internal" href="#installation-du-plugin-abeille">Installation du plugin Abeille</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backup-du-docker">Backup du Docker</a><ul>
<li><a class="reference internal" href="#commit-save-load">Commit / Save / Load</a></li>
<li><a class="reference internal" href="#commit">Commit</a></li>
</ul>
</li>
<li><a class="reference internal" href="#save">Save</a></li>
<li><a class="reference internal" href="#load">Load</a></li>
<li><a class="reference internal" href="#export-import">Export / Import</a></li>
<li><a class="reference internal" href="#export">Export</a></li>
<li><a class="reference internal" href="#import">Import</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li><a class="reference internal" href="#docker-gui">Docker GUI</a><ul>
<li><a class="reference internal" href="#sur-la-raspbian">Sur la raspbian</a></li>
<li><a class="reference internal" href="#sur-la-hypriot">Sur la hypriot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugins">Plugins</a><ul>
<li><a class="reference internal" href="#zwave">Zwave</a></li>
<li><a class="reference internal" href="#homebridge">homebridge</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-sur-une-vm-ubuntu">Installation sur une VM Ubuntu</a><ul>
<li><a class="reference internal" href="#installation-de-l-os">Installation de l’OS</a></li>
<li><a class="reference internal" href="#preparation-de-l-os">Preparation de l’OS</a></li>
<li><a class="reference internal" href="#installation-de-la-base-mysql">Installation de la base mysql</a></li>
<li><a class="reference internal" href="#installation-de-jeedom">Installation de Jeedom</a></li>
<li><a class="reference internal" href="#id2">Installation du Plugin Abeille</a></li>
<li><a class="reference internal" href="#utilisation-de-jeedom">Utilisation de Jeedom</a></li>
<li><a class="reference internal" href="#installation-sur-une-machine-odroid-xu4-avec-ubuntu">Installation sur une machine Odroid XU4 avec Ubuntu</a></li>
<li><a class="reference internal" href="#id3">Installation de l’OS</a></li>
<li><a class="reference internal" href="#id4">Preparation de l’OS</a></li>
<li><a class="reference internal" href="#id5">Installation de la base mysql</a></li>
<li><a class="reference internal" href="#id6">Installation de Jeedom</a></li>
<li><a class="reference internal" href="#id7">Installation du Plugin Abeille</a></li>
<li><a class="reference internal" href="#id8">Utilisation de Jeedom</a></li>
</ul>
</li>
<li><a class="reference internal" href="#de-installation">De-installation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Docker.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation Abeille 12.12.2019</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Docker</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, KiwiHC16.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>